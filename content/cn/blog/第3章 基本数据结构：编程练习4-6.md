---
categories: Python æ•°æ®ç»“æ„ä¸ç®—æ³•åˆ†æ(ç¬¬2ç‰ˆ)
title: ç¬¬3ç«  åŸºæœ¬æ•°æ®ç»“æ„ï¼šç¼–ç¨‹ç»ƒä¹ 4-6
tags: [ ä¹¦ç±, python]
date: 2023-03-04
lastmod: 2023-03-27 
thumbnail: https://thumbsnap.com/i/AdjDN43H.jpg
published: "true"
slug: 7kzc0y9
---

## 1 ç¼–ç¨‹ç»ƒä¹ 4
### 1.1 è¦æ±‚
å°†åœ¨[ç¼–ç¨‹ç»ƒä¹ 3]({{< ref "/blog/ç¬¬3ç« %20åŸºæœ¬æ•°æ®ç»“æ„ï¼šç¼–ç¨‹ç»ƒä¹ 1-3#3-ç¼–ç¨‹ç»ƒä¹ 3" >}})ä¸­å®ç°çš„ç®—æ³•åšæˆä¸€ä¸ªè®¡ç®—å™¨

### 1.2 éœ€è¦çš„ä¸»è¦å·¥å…·
    1. python 3.8
    2. Django 3.0.4
    3. VSCode
    4. Bootstrap 4.0
    5. jquery
### 1.3 åˆ›å»ºé¡¹ç›®Datastructureå’Œåº”ç”¨Calculator
>è¿›å…¥å·¥ä½œç›®å½•ã€‚
>`django-admin startproject  Datastructure`  
>è¿›å…¥Datastructureç›®å½•ã€‚
>`py manage.py startapp Calculator`
    
### 1.4 åœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»ºtemplatesç›®å½•ã€staticç›®å½•å’Œmediaç›®å½•
>é¡¹ç›®ç›®å½•ä¸‹çš„templatesç›®å½•å­˜æ”¾é¡¹ç›®é€šç”¨æ¨¡æ¿ï¼Œå¦‚base.htmlã€‚
>å„åº”ç”¨appçš„æ¨¡æ¿å­˜æ”¾åœ¨å„åº”ç”¨ç›®å½•ä¸‹çš„templatesç›®å½•ä¸‹åº”ç”¨å­ç›®å½•ä¸‹é¢ã€‚
>staticç›®å½•å­˜æ”¾é™æ€èµ„æºï¼Œå¦‚cssã€jsã€å›¾æ ‡ç­‰ã€‚mediaå­˜æ”¾å¯ä»¥åŠ¨æ€è°ƒæ•´çš„åª’ä½“æ–‡ä»¶ã€‚

### 1.5 å»ºç«‹ base.htmlï¼Œæ”¾åˆ° templates ç›®å½•ã€‚
```html
    <!DOCTYPE html>
    <html lang="en">    
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>{{ title }}</title>
        {% load static %}
        <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
        <script src="{% static 'js/jquery.slim.min.js' %}"></script>
        <script src="{% static 'js/bootstrap.min.js' %}"></script>
    </head>    
    <body>
        {% block content %}
        {% endblock %}
    </body>    
    </html>
```

```html
    <!DOCTYPE html>
    <html lang="en">    
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>{{ title }}</title>
        {% load static %}
        <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
        <script src="{% static 'js/jquery.slim.min.js' %}"></script>
        <script src="{% static 'js/bootstrap.min.js' %}"></script>
    </head>    
    <body>
        {% block content %}
        {% endblock %}
    </body>    
    </html>
```
### 1.6 ä¿®æ”¹é¡¹ç›®ç›®å½•ä¸‹çš„settings.py
```python
    INSTALLED_APPS = [
        'django.contrib.admin',
        'django.contrib.auth',
        'django.contrib.contenttypes',
        'django.contrib.sessions',
        'django.contrib.messages',
        'django.contrib.staticfiles',     
        'Calculator.apps.CommodityConfig', #è¿™ä¸€è¡Œæ˜¯æ–°å¢çš„        
    ]
    MIDDLEWARE = [        'django.middleware.security.SecurityMiddleware',        'django.contrib.sessions.middleware.SessionMiddleware',
'django.middleware.common.CommonMiddleware',        'django.middleware.locale.LocaleMiddleware',#è¿™ä¸€è¡Œæ˜¯æ–°å¢çš„ï¼Œä¸­æ–‡æ”¯æŒ 
'django.middleware.csrf.CsrfViewMiddleware',        'django.contrib.auth.middleware.AuthenticationMiddleware',        'django.contrib.messages.middleware.MessageMiddleware',        'django.middleware.clickjacking.XFrameOptionsMiddleware',
    ]
    TEMPLATES = [
        {'BACKEND': 'django.template.backends.django.DjangoTemplates',
            'DIRS': [os.path.join(BASE_DIR,'templates')],#è¿™ä¸€è¡Œæ˜¯ä¿®æ”¹çš„
            'APP_DIRS': True,#è¿™ä¸€è¡Œæ˜¯ä¿®æ”¹çš„
            'OPTIONS': {
                'context_processors': [                    'django.template.context_processors.debug',                    'django.template.context_processors.request',                    'django.contrib.auth.context_processors.auth',                    'django.contrib.messages.context_processors.messages',                ],
            },
        },
    ]
    DATABASES = {
        'default': {
            'ENGINE': 'django.db.backends.mysql', #æ–°å¢å¯¹mysqlçš„æ”¯æŒï¼Œæœ¬é¡¹ç›®æ— éœ€æ•°æ®åº“æ”¯æŒï¼Œè¯¥é¡¹è®¾ç½®å¯ä»¥ä¸ç”¨
            'NAME': 'babys',
            'USERNAME':'chenqian',
            'PASSWORD':'123456',
            'HOST':'127.0.0.1',
            'PORT':'3306',
        }
    }
    STATIC_URL = '/static/'
    ä¸‹é¢ä¸‰è¡Œæ˜¯æ–°å¢çš„
    STATICFILES_DIRS = (os.path.join(BASE_DIR , 'static'),)
    MEDIA_URL = '/media/'    #å¯ä»¥ä¸éœ€è¦
    MEDIA_ROOT = os.path.join(BASE_DIR, 'media')      #å¯ä»¥ä¸éœ€è¦
```
### 1.7 ä¿®æ”¹è·¯ç”±urls.py
```python
from django.contrib import admin
from django.urls import path,re_path,include
from . import views
from django.views.static import serve
from django.conf import settings
urlpatterns = [
	path('admin/', admin.site.urls),    
	path('Calculator/',include('Calculator.urls')),    
]
```

```python
from django.urls import path
from . import views

app_name = 'Calculator'
urlpatterns = [
	path('',views.Calculator, name = 'Calculator'),        
]
```

### 1.8 å»ºç«‹Templates
åœ¨Calculatorç›®å½•ä¸‹å»ºç«‹templates\Calculatorç›®å½•ï¼Œåœ¨è¯¥ç›®å½•ä¸‹åˆ›å»ºæ¨¡æ¿(Calculator.htmlæ–‡ä»¶)ï¼Œä»¥æ˜¾ç¤ºæ•°æ®ã€‚
Calculator.htmlï¼š
```html
{% extends 'base.html' %}

{% block style %}
<style>
	.calbox {
		background-image: linear-gradient(135deg, #D9DCE8, #E2E4EF);
		display: inline-block;
		text-align: center;
		margin: 8px;
		width: 66px;
		height: 54px;
		line-height: 54px;
		border-radius: 16px;
		box-shadow: inset 1px 1px 1px 0px rgba(255, 255, 255, 0.8), inset -1px -1px 1px 0px rgba(40, 49, 85, 0.3), 1px 1px 3px 0px rgba(40, 49, 85, 0.1);
		font-size: 20px;
		user-select: none;
		color: #283155;
		text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.1);
		opacity: 1 !important;
	}

	.calbox:hover {
		background: #cfd2e0;
		cursor: pointer;
	}

	.calbox:active {
		box-shadow: none;
		color: #747a92;
		transform: scale(0.95);
		text-shadow: none;
		background: #cfd2e0;
	}
</style>
{% endblock %}

{% block content %}
{% csrf_token %}
<div class="container border rounded" style="width:600px;margin-top:100px;background-color:rgb(245, 244, 244)">
	<div class="row mx-1 my-3">
		<input type="text" class="form-control border rounded" placeholder="0"
			style="text-align:end;height:50px;font-size:30px" id="result">
	</div>
	<div class="row">
		<div class="col">
			<div class="calbox num_or_op" id="(">(</div>
		</div>
		<div class="col">
			<div class="calbox num_or_op" id=")">)</div>
		</div>
		<div class="col">
			<div class="calbox" id="backspace">
				<span class="fa fa-long-arrow-left"></span>
			</div>
		</div>
		<div class="col">
			<div class="calbox" id="CE">CE</div>
		</div>
	</div>
	<div class="row">
		<div class="col">
			<div class="calbox num_or_op" id="7">7</div>
		</div>
		<div class="col">
			<div class="calbox num_or_op" id="8">8</div>
		</div>
		<div class="col">
			<div class="calbox num_or_op" id="9">9</div>
		</div>
		<div class="col">
			<div class="calbox num_or_op" id="Ã·">&divide;</div>
		</div>
	</div>
	<div class="row">
		<div class="col">
			<div class="calbox num_or_op" id="4">4</div>
		</div>
		<div class="col">
			<div class="calbox num_or_op" id="5">5</div>
		</div>
		<div class="col">
			<div class="calbox num_or_op" id="6">6</div>
		</div>
		<div class="col">
			<div class="calbox num_or_op" id="Ã—">&times;</div>
		</div>
	</div>
	<div class="row">
		<div class="col">
			<div class="calbox num_or_op" id="1">1</div>
		</div>
		<div class="col">
			<div class="calbox num_or_op" id="2">2</div>
		</div>
		<div class="col">
			<div class="calbox num_or_op" id="3">3</div>
		</div>
		<div class="col">
			<div class="calbox num_or_op" id="-">-</div>
		</div>
	</div>
	<div class="row">
		<div class="col">
			<div class="calbox num_or_op" id="0">0</div>
		</div>
		<div class="col">
			<div class="calbox num_or_op" id=".">.</div>
		</div>
		<div class="col">
			<div class="calbox" id="equal">=</div>
		</div>
		<div class="col">
			<div class="calbox num_or_op" id="+">+</div>
		</div>
	</div>
</div>
{% endblock %}

{% block script %}
<script>
	$(".num_or_op").click(function () {
		var temp = $("#result").val()
		if (temp == '0') {
			$("#result").val(this.id)
		} else {
			$("#result").val(temp + this.id)
		}
	})
	$("#backspace").click(function () {
		var temp = $("#result").val()
		$("#result").val(temp.slice(0, -1))
	})
	$("#CE").click(function () {
		$("#result").val('0')
	})
	$("#equal").click(function () {
		var csrf = $('input[name="csrfmiddlewaretoken"]').val()
		var url = "{% url 'Calculator:Calculator' %}"
		var data = {
			'expr': $("#result").val(),
			'csrfmiddlewaretoken': csrf
		};
		$.post(url, data, function (data) {            
			$("#result").val(data.result)
		})
	})
</script>
{% endblock %}
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼šajax å‘é€ post è¯·æ±‚æ—¶ï¼Œè§£å†³ csrf æŠ¥é”™çš„æ–¹æ³•ï¼š
>ç¬¬ä¸€æ­¥ï¼šåœ¨bodyæ ‡ç­¾ä¸­åŠ ä¸Šè¿™å¥è¯ï¼š
>>`{% csrf_token %}`
>
>ç¬¬äºŒæ­¥ï¼šjsä¸­å®šä¹‰æ­¤å˜é‡
 >>`var csrf = $('input[name="csrfmiddlewaretoken"]').val()`;
>
>ç¬¬ä¸‰æ­¥ï¼šå°†æ­¤å˜é‡ä¼ é€’ç»™åç«¯ï¼Œusernameå’Œpasswordæ˜¯è‡ªå·±å®šä¹‰çš„å¯å¿½ç•¥
 >>`data:{"username": u, "password": p, 'csrfmiddlewaretoken': csrf}`

ç»“æœç•Œé¢å¦‚ä¸‹ï¼š

 ![Untitled](https://thumbsnap.com/i/BaBuRSsV.png)

### 1.9 åœ¨views.pyä¸­åˆ›å»ºè§†å›¾å‡½æ•°
éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå·¥ä½œç›®å½•æ˜¯ Datastructureï¼Œè€Œ views.py ä½äºå·¥ä½œç›®å½•çš„å­ç›®å½• Calculatorï¼Œå› æ­¤ä¸ºäº†å¯¼å…¥ views.py åŒä¸€ç›®å½•ä¸‹çš„ py æ–‡ä»¶ï¼Œå¦‚stack.pyã€ä¸­åºè¡¨è¾¾å¼.py å’Œ ç›´æ¥çš„ä¸­åºè®¡ç®—.pyï¼Œæ–‡ä»¶åå‰åŠ  â€œ.â€å·ã€‚

```python
from django.shortcuts import render
from django.http import JsonResponse
from .stack import Stack
import re
from .ä¸­åºè¡¨è¾¾å¼ import InfixExpr
from .ç›´æ¥çš„ä¸­åºè®¡ç®— import infixExprEval,doMath

# Create your views here.
def Calculator(request):
	if request.method == "GET":
		return render(request,'Calculator/calculator.html')        
	if request.is_ajax():
		expr = request.POST.get('expr')        
		infixExpr = InfixExpr(expr)
		validation = infixExpr.validate()
		if validation['flag'] == True:
		   result = {'result':infixExprEval(infixExpr.exprList)}
		else:
		   result = {'result':validation['errorCode']}
		return JsonResponse(result,safe=False)
```

    
## 2 ç¼–ç¨‹ç»ƒä¹ 5
### 2.1 è¦æ±‚
ä½¿ç”¨åˆ—è¡¨å®ç°é˜Ÿåˆ—æŠ½è±¡æ•°æ®ç±»å‹ï¼Œå°†åˆ—è¡¨çš„åç«¯ä½œä¸ºé˜Ÿåˆ—çš„å°¾éƒ¨

è§ [4.2 å®ç°æ–¹æ³•äºŒï¼Œåˆ—è¡¨å°¾å…¥é˜Ÿï¼Œåˆ—è¡¨å¤´å‡ºé˜Ÿ]({{< ref "/blog/ç¬¬3ç« %20åŸºæœ¬æ•°æ®ç»“æ„#4.2-å®ç°æ–¹æ³•äºŒï¼Œåˆ—è¡¨å°¾å…¥é˜Ÿï¼Œåˆ—è¡¨å¤´å‡ºé˜Ÿ" >}})

ç”±ä¸Šè¿°ä»£ç å¯çŸ¥ï¼Œå…¥é˜Ÿæ“ä½œ(æ·»åŠ å…ƒç´ ï¼Œappend(item))çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(1)ï¼Œå‡ºé˜Ÿæ“ä½œ(ç§»é™¤å…ƒç´ ï¼Œpop(0))çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(n)ã€‚

## 3 ç¼–ç¨‹ç»ƒä¹ 6
### 3.1 è¦æ±‚
è®¾è®¡å’Œå®ç°ä¸€ä¸ªè¯•éªŒï¼Œå¯¹æ¯”ä¸¤ç§é˜Ÿåˆ—å®ç°çš„æ€§èƒ½ã€‚èƒ½ä»è¯¥è¯•éªŒä¸­å­¦åˆ°ä»€ä¹ˆï¼Ÿ
### 3.2 è¯•éªŒæ€è·¯
å»ºç«‹ä¸€ä¸ªå‡½æ•° foo(aQueue)ï¼Œæ¥æ”¶é˜Ÿåˆ—å‚æ•°ï¼Œç„¶åæ‰§è¡Œå…¥é˜Ÿæ“ä½œ100000æ¬¡å’Œå‡ºé˜Ÿæ“ä½œ100000æ¬¡ã€‚åˆ©ç”¨ timeit æ¨¡å—ï¼Œé’ˆå¯¹ä¸¤ç§é˜Ÿåˆ—å®ç°çš„æ–¹å¼ï¼Œåˆ†åˆ«æ„é€ ä¸€ä¸ªå®ä¾‹ï¼Œä¼ é€’ç»™å‡½æ•° foo()ï¼Œæ‰§è¡Œ1æ¬¡ï¼Œå¾—åˆ°æ¶ˆè€—çš„æ—¶é—´ã€‚

```python
import timeit

def foo(aQueue):
    aQueue._items = []   #æ¯æ¬¡æ‰§è¡Œå‡½æ•°å‰ï¼Œæ¸…ç©ºé˜Ÿåˆ—
    for i in range(100000):
        aQueue.enqueue(i)
    for i in range(100000):
        aQueue.dequeue()

tt = timeit.Timer(stmt='foo(aQueue)',setup='from __main__ import foo,aQueue')
aQueue = MyQueue1()  #åˆ—è¡¨å¤´å…¥é˜Ÿï¼Œåˆ—è¡¨å°¾å‡ºé˜Ÿ
print(tt.timeit(1))
aQueue = MyQueue2()  #åˆ—è¡¨å°¾å…¥é˜Ÿï¼Œåˆ—è¡¨å¤´å‡ºé˜Ÿ
print(tt.timeit(1))
```

ç»“æœåˆ†åˆ«æ˜¯ 3.46 å’Œ 2.21 ï¼Œè¯´æ˜å°†åˆ—è¡¨çš„åç«¯ä½œä¸ºé˜Ÿåˆ—çš„å°¾éƒ¨ï¼Œä¹Ÿå°±æ˜¯åˆ—è¡¨å°¾å…¥é˜Ÿï¼Œåˆ—è¡¨å¤´å‡ºé˜Ÿï¼Œæ€§èƒ½ç•¥ä¼˜ã€‚
¼˜ã€‚
